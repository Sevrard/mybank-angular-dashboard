<div class="dashboard-wrapper" #pdfContent>

  <header class="dash-header">
    <div class="header-titles">
      <h1 class="page-title">Vue d'ensemble</h1>
      <p class="subtitle">Bienvenue sur votre espace financier.</p>
    </div>
    
    <div class="dash-filters">
      <period-filter 
        [period]="data.period()"
        (periodChange)="data.setPeriod($event)">
      </period-filter>
      <month-filter 
        [month]="data.month()"
        (monthChange)="data.setMonth($event)">
      </month-filter>
    </div>
  </header>

  <section class="kpi-grid">
    <mat-card class="kpi-card main-balance">
      <div class="kpi-icon"><mat-icon>account_balance_wallet</mat-icon></div>
      <div class="kpi-info">
        <span class="label">Solde total</span>
        <span class="value">{{ data.balance() | number:'1.2-2' }} €</span>
      </div>
    </mat-card>

    <mat-card class="kpi-card income">
      <div class="kpi-icon color-in-bg"><mat-icon class="color-in">trending_up</mat-icon></div>
      <div class="kpi-info">
        <span class="label">Revenus</span>
        <span class="value color-in">+{{ data.income() | number:'1.0-0' }} €</span>
      </div>
    </mat-card>

    <mat-card class="kpi-card expense">
      <div class="kpi-icon color-out-bg"><mat-icon class="color-out">trending_down</mat-icon></div>
      <div class="kpi-info">
        <span class="label">Dépenses</span>
        <span class="value color-out">-{{ data.expenses() | number:'1.0-0' }} €</span>
      </div>
    </mat-card>
  </section>

  <section class="accounts-row">
    <span class="section-title">Mes comptes :</span>
    <div class="account-pill" *ngFor="let acc of data.accounts">
      <div class="acc-details">
        <span class="acc-name">{{ acc.name }}</span>
        <span class="acc-iban">{{ acc.iban }}</span>
      </div>
      <span class="acc-balance">{{ acc.balance | number:'1.2-2' }} €</span>
    </div>
  </section>

  <div class="main-content-grid">
    
    <div class="charts-column">
      <mat-card class="content-card">
        <div class="card-header">
          <h3>Évolution du solde</h3>
        </div>
        <div class="chart-wrapper">
          <app-line-chart [transactions]="data.filteredTransactions()"></app-line-chart>
        </div>
      </mat-card>

      <mat-card class="content-card">
        <div class="card-header">
          <h3>Flux de trésorerie (Dépenses / Recettes)</h3>
        </div>
        <div class="chart-wrapper">
          <app-bart-chart [data]="data.filteredCashFlow()"></app-bart-chart>
        </div>
      </mat-card>
    </div>

    <div class="transactions-column">
      <mat-card class="content-card full-height">
        <div class="card-header">
          <h3>Dernières transactions</h3>
          <button mat-icon-button><mat-icon>more_horiz</mat-icon></button>
        </div>
        
        <div class="compact-table-container">
          <table mat-table [dataSource]="data.filteredTransactions()">

            <ng-container matColumnDef="type">
              <th mat-header-cell *matHeaderCellDef></th>
              <td mat-cell *matCellDef="let t" class="icon-cell">
                <mat-icon [ngClass]="t.type === 'in' ? 'color-in' : 'color-out'">
                  {{ t.type === 'in' ? 'arrow_upward' : 'arrow_downward' }}
                </mat-icon>
              </td>
            </ng-container>

            <ng-container matColumnDef="from">
              <th mat-header-cell *matHeaderCellDef>Destinataire</th>
              <td mat-cell *matCellDef="let t" class="truncate-cell">{{ t.from }}</td>
            </ng-container>

            <ng-container matColumnDef="amount">
              <th mat-header-cell *matHeaderCellDef>Montant</th>
              <td mat-cell *matCellDef="let t" class="amount-cell" [ngClass]="t.type === 'in' ? 'color-in' : 'color-out'">
                {{ t.amount | number:'1.2-2' }} €
              </td>
            </ng-container>

            <ng-container matColumnDef="date">
              <th mat-header-cell *matHeaderCellDef>Date</th>
              <td mat-cell *matCellDef="let t" class="date-cell">{{ t.date }}</td>
            </ng-container>

            <tr mat-header-row *matHeaderRowDef="displayedColumns; sticky: true"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns" class="compact-row"></tr>
          </table>
        </div>
      </mat-card>
    </div>

  </div>

</div>